<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Meristem NGX Trade Calculator</title>
<script src="https://cdn.tailwindcss.com"></script>
</head>

<body class="bg-gray-100 min-h-screen flex items-center justify-center p-6">

<div class="bg-white w-full max-w-3xl rounded-2xl shadow-xl p-8">

  <!-- HEADER -->
  <div class="text-center mb-8">
    <h1 class="text-3xl font-bold text-gray-800">Stock Transaction Calculator</h1>
    <p class="text-gray-500 mt-2">
      Calculate buy/sell costs with full fee breakdown for NGX
    </p>
  </div>

  <!-- BUY SELL -->
  <div class="flex bg-gray-200 rounded-xl p-1 mb-6">
    <button onclick="setType('buy')" id="buyBtn"
      class="w-1/2 py-3 rounded-xl bg-purple-600 text-white font-semibold">
      Buy
    </button>
    <button onclick="setType('sell')" id="sellBtn"
      class="w-1/2 py-3 rounded-xl text-gray-600 font-semibold">
      Sell
    </button>
  </div>

  <!-- MODE -->
  <div class="flex bg-gray-100 rounded-xl p-1 mb-6">
    <button onclick="setMode('units')" id="unitsBtn"
      class="w-1/2 py-2 rounded-xl bg-purple-600 text-white font-semibold">
      Units & Price to Total
    </button>
    <button onclick="setMode('budget')" id="budgetBtn"
      class="w-1/2 py-2 rounded-xl text-gray-600 font-semibold">
      Budget to Units
    </button>
  </div>

  <!-- INPUTS -->
  <div class="grid grid-cols-1 md:grid-cols-2 gap-4">

    <div>
      <label class="text-sm text-gray-500">Units</label>
      <input id="units" type="number" class="w-full border p-3 rounded-lg">
    </div>

    <div>
      <label class="text-sm text-gray-500">Price per Unit (₦)</label>
      <input id="price" type="number" class="w-full border p-3 rounded-lg">
    </div>

    <div>
      <label class="text-sm text-gray-500">Budget (₦)</label>
      <input id="budget" type="number" class="w-full border p-3 rounded-lg">
    </div>

    <div>
      <label class="text-sm text-gray-500">Brokerage (%)</label>
      <input id="brokerage" type="number" value="1.35" step="0.01"
        class="w-full border p-3 rounded-lg">
    </div>

  </div>

  <button onclick="calculate()" 
    class="w-full mt-6 bg-purple-600 hover:bg-purple-700 text-white py-3 rounded-xl font-semibold">
    Calculate
  </button>

  <!-- RESULT -->
  <div id="result" class="mt-8 text-sm"></div>

</div>

<script>

let tradeType = "buy";
let mode = "units";

function setType(type){
  tradeType = type;
  document.getElementById("buyBtn").classList.toggle("bg-purple-600", type==="buy");
  document.getElementById("buyBtn").classList.toggle("text-white", type==="buy");
  document.getElementById("sellBtn").classList.toggle("bg-purple-600", type==="sell");
  document.getElementById("sellBtn").classList.toggle("text-white", type==="sell");
}

function setMode(m){
  mode = m;
  document.getElementById("unitsBtn").classList.toggle("bg-purple-600", m==="units");
  document.getElementById("unitsBtn").classList.toggle("text-white", m==="units");
  document.getElementById("budgetBtn").classList.toggle("bg-purple-600", m==="budget");
  document.getElementById("budgetBtn").classList.toggle("text-white", m==="budget");
}

function calculate(){

  let units = parseFloat(document.getElementById("units").value);
  const price = parseFloat(document.getElementById("price").value);
  const budget = parseFloat(document.getElementById("budget").value);
  const brokerageRate = parseFloat(document.getElementById("brokerage").value)/100;

  let gross;

  if(mode === "units"){
    gross = units * price;
  } else {
    // reverse engineer
    const percentageFees = brokerageRate 
      + (brokerageRate * 0.0075) 
      + (tradeType==="buy" ? 0.003 + 0.0008 : 0.003 + 0.003 + 0.0008);

    const flatFee = 10.75;

    if(tradeType==="buy"){
      gross = (budget - flatFee) / (1 + percentageFees);
    } else {
      gross = (budget + flatFee) / (1 - percentageFees);
    }

    units = Math.floor(gross / price);
    gross = units * price;
  }

  const brokerage = gross * brokerageRate;
  const vat = brokerage * 0.0075;
  const alert = 10.75;
  const stamp = gross * 0.0008;

  let otherFees;

  if(tradeType==="buy"){
    const sec = gross * 0.003;
    otherFees = sec + stamp;
  } else {
    const nse = gross * 0.003;
    const cscs = gross * 0.003;
    otherFees = nse + cscs + stamp;
  }

  const totalFees = brokerage + vat + alert + otherFees;

  const net = tradeType==="buy"
    ? gross + totalFees
    : gross - totalFees;

  document.getElementById("result").innerHTML = `
    <div class="bg-gray-50 p-6 rounded-xl border space-y-2">
      <p><strong>Units:</strong> ${units.toLocaleString()}</p>
      <p><strong>Gross Value:</strong> ₦${gross.toLocaleString(undefined,{minimumFractionDigits:2})}</p>
      <p><strong>Brokerage:</strong> ₦${brokerage.toFixed(2)}</p>
      <p><strong>VAT on Brokerage:</strong> ₦${vat.toFixed(2)}</p>
      <p><strong>CSCS Alert:</strong> ₦10.75</p>
      <p><strong>Other Statutory Fees:</strong> ₦${otherFees.toFixed(2)}</p>
      <hr class="my-2">
      <p><strong>Total Fees:</strong> ₦${totalFees.toFixed(2)}</p>
      <p class="text-lg font-bold text-purple-700">
        ${tradeType==="buy"?"Total Payable":"Net Proceeds"}:
        ₦${net.toLocaleString(undefined,{minimumFractionDigits:2})}
      </p>
    </div>
  `;
}

</script>

</body>
</html>
